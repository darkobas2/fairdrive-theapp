import React, { useContext, useEffect, useState } from "react";
import { ThemeContext } from "../../store/themeContext/themeContext";
import { StoreContext } from "../../store/store";
import useStyles from "./podSidebarStyles";
import ButtonPill from "../buttonPill/buttonPill";
import Toggle from "../toggle/toggle";
import { getPods } from "../../store/services/fairOS";
import { PodChevron, PodInfo } from "../icons/icons";

export interface Props {
  isOpen: boolean;
  route: string;
}

function PodSidebar(props: Props) {
  const { state, actions } = useContext(StoreContext);
  const { theme } = useContext(ThemeContext);
  const [ isPrivate, setIsPrivate] = useState(false)
  const classes = useStyles({ ...props, ...theme });
  const pods = ["Private Pod", "Shared Pod", "My Photos"];
  useEffect(() => {
    if (state.podsOpened.includes(state.podName))
      actions.getDirectory({ directory: "root", podName: state.podName });
  }, [state.podName, state.podsOpened]);

  const setPod = async (pod) => {
    debugger;
    actions.setPodName(pod);
    if (!state.podsOpened.includes(pod))
      actions.openPod({ password: state.password, podName: pod });
  };

  const setOverview= async (pod) => {
    debugger;
    // await actions.setPodName(pod);
    // if (!state.podsOpened.includes(pod))
    //   await actions.openPod({ password: state.password, podName: pod });
  };

  return (
    <div className={classes.podDrawer}>
       <Toggle show={props.route !== "Overview"} isLeft={isPrivate} setLeft={setIsPrivate}/>
          <div className={classes.podInfoWrapper}>
            <PodInfo className={classes.podInfo} />
            <div className={classes.information}>
            {props.route === "Overview" ? "These below pods are automatically generateed for your Owned Content (Home pod) and Shared Content (Shared Pod" :  "Switch from Shared to Owned to see Home Pod" }
            </div>
          </div>
          <div className={classes.divider}></div>
          <button className={classes.podButton}>
          {isPrivate? "Create Pod" :  "Import Pod"  }
         
          </button>
        { props.route === "Overview" ?
          <div className={classes.pods}>
            {pods.map((pod) => {
              return (
                <div className={classes.podRow} onClick={() => setOverview(pod)}>
                  <label>{pod}</label>
                  <PodChevron className={classes.podChevron} />
                </div>
              );
            })}
          </div> :
          <div className={classes.pods}>
            {state.pods.map((pod) => {
              return (
                <div className={classes.podRow} onClick={() => setPod(pod)}>
                  <label>{pod}</label>
                  <PodChevron className={classes.podChevron} />
                </div>
              );
            })}
          </div> }
          <div className={classes.podInfoWrapper}>
            <PodInfo className={classes.podInfo} />
            <div className={classes.information}>
              My photos pod is an autogenerated Pod that can be used with
              Fairphoto.
            </div>
          </div>
    </div>
  );
}

export default React.memo(PodSidebar);
